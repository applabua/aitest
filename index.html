<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ASSISTANT AI —  ИИ Ассистент (прототип)</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Roboto+Mono&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#0b1020;
    --bg2:#081021;
    --glass: rgba(255,255,255,0.04);
    --accent: #6be7ff;
    --accent-2: #8a6bff;
    --muted: rgba(255,255,255,0.12);
    --msg-user: linear-gradient(135deg,#0ea5a4,#0ea5c4);
    --msg-ai: linear-gradient(135deg,#2b2f46,#343755);
    --radius: 14px;
    --shadow-lg: 0 20px 50px rgba(2,6,23,0.7);
    --glass-border: rgba(255,255,255,0.04);
    --glass-highlight: rgba(107,231,255,0.06);
  }

  /* Page background with slow gradient animation */
  body{
    margin:0;
    min-height:100vh;
    font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:
      radial-gradient(800px 400px at 10% 10%, rgba(138,107,255,0.07), transparent 8%),
      radial-gradient(600px 300px at 90% 90%, rgba(107,231,255,0.04), transparent 8%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    color: #e8eefc;
    -webkit-font-smoothing:antialiased;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    box-sizing:border-box;
    overflow:hidden;
  }

  /* Patterned animated background elements */
  .pattern {
    position: fixed;
    inset: 0;
    pointer-events: none;
    background-image:
      radial-gradient(circle at 10% 20%, rgba(138,107,255,0.05) 0 120px, transparent 121px),
      radial-gradient(circle at 90% 80%, rgba(107,231,255,0.03) 0 120px, transparent 121px),
      repeating-linear-gradient(45deg, rgba(255,255,255,0.006) 0 1px, transparent 1px 20px);
    mix-blend-mode: overlay;
    opacity: 0.8;
    animation: patternMove 16s linear infinite;
  }
  @keyframes patternMove { from { transform: translateX(-2%); } to { transform: translateX(2%); } }

  /* Main card */
  .card{
    width:980px;
    max-width:98vw;
    height:680px;
    max-height:94vh;
    border-radius:18px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--glass-border);
    display:grid;
    grid-template-columns: 340px 1fr;
    overflow:hidden;
    backdrop-filter: blur(8px) saturate(120%);
    position:relative;
  }

  /* Preloader (over card) */
  #preloader {
    position: fixed;
    inset: 0;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:9999;
    background: var(--bg1); /* или любой цвет, например #0b1020 */
    transition: opacity 0.45s ease, visibility 0.45s;
  }
  /* make preloader look like dialog window background with neon logo */
  #preloader-inner{
    width:520px;
    max-width:88vw;
    padding:28px 36px;
    border-radius:14px;
    display:flex;
    gap:16px;
    align-items:center;
    justify-content:center;
    box-shadow: var(--shadow-lg);
    border:1px solid rgba(255,255,255,0.03);
    background: linear-gradient(180deg, rgba(2,6,23,0.6), rgba(8,16,33,0.65));
    position:relative;
    overflow:hidden;
  }
  /* subtle animated neon lines inside preloader */
  #preloader-inner::before,
  #preloader-inner::after{
    content:'';
    position:absolute;
    inset:-30%;
    background: radial-gradient(circle at 20% 30%, rgba(107,231,255,0.04), transparent 10%),
                radial-gradient(circle at 80% 70%, rgba(138,107,255,0.03), transparent 10%);
    filter: blur(30px);
    animation: float 8s linear infinite;
  }
  #preloader-inner::after { animation-duration:12s; transform: rotate(90deg); }
  @keyframes float { from{transform:translateY(-6%)} to{transform:translateY(6%)} }

  .pre-logo {
    width:68px;height:68px;border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    font-weight:800;font-family:"Roboto Mono";
    background: linear-gradient(135deg,var(--accent),var(--accent-2));
    color:#041224;
    font-size:28px;
    box-shadow: 0 10px 30px rgba(107,107,255,0.08);
  }
  .pre-text {
    color:#e8eefc;font-size:18px;font-weight:700;
    letter-spacing:0.6px;
  }

  /* Left panel (info / persona) */
  .left{
    padding:22px;
    border-right:1px solid rgba(255,255,255,0.02);
    display:flex;
    flex-direction:column;
    gap:18px;
    background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent 60%);
  }
  .brand{
    display:flex;
    gap:12px;
    align-items:center;
  }
  .logo{
    width:52px;height:52px;border-radius:12px;
    background:linear-gradient(135deg,var(--accent),var(--accent-2));
    display:flex;align-items:center;justify-content:center;
    font-weight:800;color:#041224;font-family:"Roboto Mono";
    box-shadow: 0 6px 18px rgba(138,107,255,0.12);
  }
  .brand h3{ margin:0;font-size:16px;letter-spacing:0.4px; }
  .brand p{ margin:0;font-size:12px;color:var(--muted) }

  .persona{
    padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015));
    border:1px solid rgba(255,255,255,0.02);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
    font-size:13px;color:var(--muted);
  }

  .left .chips{ display:flex;flex-wrap:wrap;gap:8px; margin-top:6px;}
  .chip{
    background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px 10px;border-radius:999px;font-size:13px;color:var(--muted);
  }

  /* Right: chat area */
  .right{
    display:flex;
    flex-direction:column;
    padding:20px;
    gap:12px;
    position:relative;
  }

  .chat-header{
    display:flex;align-items:center;justify-content:space-between;
    gap:12px;padding:6px 4px;
  }
  .chat-title{
    display:flex;gap:12px;align-items:center;
  }
  .avatar{
    width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#223048,#2b3750);display:flex;align-items:center;justify-content:center;font-weight:700;
    box-shadow: 0 6px 20px rgba(2,6,23,0.6), 0 0 18px rgba(107,231,255,0.04) inset;
  }
  .chat-title h2{ margin:0;font-size:16px }
  .chat-title p{ margin:0;font-size:12px;color:var(--muted) }

  /* Messages viewport */
  .messages{
    flex:1;
    padding:18px;
    overflow:auto;
    display:flex;
    flex-direction:column;
    gap:14px;
    scroll-behavior:smooth;
    -webkit-overflow-scrolling:touch;
  }
  /* nice soft scrollbar */
  .messages::-webkit-scrollbar{ width:8px; }
  .messages::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.03); border-radius:8px; }
  .messages::-webkit-scrollbar-track{ background: transparent; }

  /* message bubble base */
  .msg{
    max-width:78%;
    padding:12px 14px;
    border-radius:12px;
    font-size:14px;line-height:1.45;
    box-shadow: 0 8px 20px rgba(2,6,23,0.45);
    opacity:0;
    transform:translateY(8px) scale(0.995);
    animation: appear .38s ease forwards;
    position: relative;
  }
  @keyframes appear { to{opacity:1; transform:none;} }

  /* user message (right aligned) */
  .msg.user{
    margin-left:auto;
    background:var(--msg-user);
    color:#041224;
    border-bottom-right-radius:6px;
    position:relative;
    box-shadow: 0 12px 30px rgba(14,165,164,0.08);
    border:1px solid rgba(255,255,255,0.04);
  }
  .msg.ai{
    margin-right:auto;
    background:var(--msg-ai);
    color:#e7eefc;
    border-bottom-left-radius:6px;
    border:1px solid rgba(255,255,255,0.02);
  }

  /* thin neon highlight when hovering message */
  .msg:hover{ box-shadow: 0 18px 40px rgba(2,6,23,0.6), 0 0 18px rgba(107,231,255,0.03) inset; transform:translateY(-2px); transition:all .22s ease; }

  /* small meta row */
  .meta{ 
    font-size:11px;
    color:rgba(255,255,255,0.35); 
    margin-top:6px; 
    display:flex;gap:8px; 
    align-items:center; 
    justify-content:flex-end;
    user-select:none;
  }

  /* typing indicator */
  .typing{
    display:inline-flex; gap:6px; align-items:center;
  }
  .dot{
    width:7px;height:7px;border-radius:50%;background:#9fdcff;opacity:0.9;
    transform:scale(0.8);
    animation: blink 1s infinite;
  }
  .dot:nth-child(2){ animation-delay:.15s }
  .dot:nth-child(3){ animation-delay:.33s }
  @keyframes blink{ 0%{transform:translateY(0) scale(.7);opacity:.25}50%{transform:translateY(-6px) scale(1);opacity:1}100%{transform:translateY(0) scale(.85);opacity:.5} }

  /* input area */
  .composer{
    display:flex;
    gap:10px;
    align-items:center;
    padding:12px;
    border-top:1px solid rgba(255,255,255,0.02);
    background: linear-gradient(180deg, rgba(255,255,255,0.005), rgba(255,255,255,0.002));
  }

  .input-wrap{
    flex:1;
    display:flex;
    align-items:center;
    gap:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:8px;
    border:1px solid rgba(255,255,255,0.02);
  }
  .composer input{
    border:0;outline:0;background:transparent;color:inherit;font-size:15px;padding:10px 6px;width:100%;
  }
  .btn{
    border:0;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#041224;font-weight:700;cursor:pointer;
    box-shadow: 0 10px 30px rgba(107,107,255,0.06);
    transition:transform .12s ease;
  }
  .btn:active{ transform:translateY(2px) scale(.995) }

  /* small utility buttons - square small icons */
  .icon-square{
    width:30px;height:30px;display:inline-grid;place-items:center;border-radius:8px;border:0;cursor:pointer;font-size:14px;
    box-shadow: 0 8px 20px rgba(2,6,23,0.45);
  }
  /* play same gradient as send */
  .icon-play{
    background: linear-gradient(90deg,var(--accent),var(--accent-2));
    color:#041224;
  }
  /* responsive */
  @media (max-width:880px){
    .card{ grid-template-columns: 1fr; height:92vh; max-height:92vh; }
    .left{ display:none; }
    .messages{ padding:12px; }
  }
</style>
</head>
<body>
  <div class="pattern" aria-hidden="true"></div>

  <!-- Preloader shown for 5s -->
  <div id="preloader" aria-hidden="false">
    <div id="preloader-inner" role="presentation">
      <div class="pre-logo" aria-hidden="true">AI</div>
      <div class="pre-text">AI ASSISTANT (Test)</div>
    </div>
  </div>

  <main class="card" role="main" aria-label="AI Assistant">
    <!-- LEFT -->
    <aside class="left" aria-hidden="false">
      <div class="brand" role="banner">
        <div class="logo">AI</div>
        <div>
          <h3>ASSISTANT AI</h3>
          <p>ИИ ассистент • Прототип</p>
        </div>
      </div>

      <div class="persona">
        <strong>Выбери модель ИИ:</strong>
        <div style="margin-top:8px;color:var(--muted);font-size:13px">
           Тест версия.
        </div>

        <div class="chips" style="margin-top:12px">
          <div class="chip">ASSISTANT AI 1.0</div>
          <div class="chip">ASSISTANT AI 2.0</div>
          <div class="chip">ASSISTANT AI 3.0</div>
          <div class="chip">ASSISTANT AI 4.0</div>
        </div>
      </div>

      <div style="margin-top:auto;font-size:12px;color:var(--muted)">
        <div style="margin-bottom:8px">Подсказки:</div>
        <ul style="padding-left:16px;margin:0;color:var(--muted);line-height:1.6">
          <li>Напиши: <code>привет</code></li>
          <li>Спроси что угодно: идеи, код, план</li>
          <li>Нажми кнопку "Отправить" для отправки</li>
        </ul>
      </div>
    </aside>

    <!-- RIGHT -->
    <section class="right">
      <div class="chat-header" role="toolbar" aria-label="Chat header">
        <div class="chat-title">
          <div class="avatar">AI</div>
          <div>
            <h2>AI Assistant 1.0</h2>
            <p>бета-версия</p>
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <button class="icon-square icon-play" id="ttsBtn" title="Воспроизвести последний ответ" aria-label="Воспроизвести последний ответ">▶</button>
        </div>
      </div>

      <div class="messages" id="messages" aria-live="polite" aria-atomic="false">
        <!-- initial welcome message -->
        <div class="msg ai" data-id="m0">
          Привет! Я — тестовый AI Assistant. Могу помочь с , идеями, планами и быстрыми ответами. Попробуй написать что-нибудь.
          <div class="meta">Помощник • сейчас</div>
        </div>
      </div>

      <form class="composer" id="composer" onsubmit="return false;" aria-label="Message composer">
        <div class="input-wrap" role="search">
          <input id="input" autocomplete="off" placeholder="Напиши сообщение..." aria-label="Текст сообщения" />
        </div>
        <button class="btn" id="sendBtn" aria-label="Отправить">Отправить</button>
      </form>
    </section>
  </main>

<script>
/* Behaviour:
 - show preloader for 5s then hide
 - single timestamp per message
 - TTS plays last AI reply
 - improved canned reply logic (more practical)
*/

// Preloader hide after 5 seconds (keeps visible while page loads)
const preloader = document.getElementById('preloader');
window.addEventListener('load', ()=> {
  // keep for exactly 5s from script run (gives consistent behavior)
  setTimeout(()=> {
    preloader.style.opacity = '0';
    preloader.style.visibility = 'hidden';
    preloader.setAttribute('aria-hidden','true');
  }, 5000);
});

// Elements
const messagesEl = document.getElementById('messages');
const inputEl = document.getElementById('input');
const sendBtn = document.getElementById('sendBtn');
const clearBtn = document.getElementById('clearBtn');
const ttsBtn = document.getElementById('ttsBtn');

let lastAiText = '';
let lastAiId = null;

// escape
function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

// append message — ensures only one meta line
function appendMessage(text, who='ai', options = {}) {
  // options: stream (bool) — if true, create content area for streaming
  const msg = document.createElement('div');
  msg.className = 'msg ' + (who === 'user' ? 'user' : 'ai');

  const content = document.createElement('div');
  content.className = 'content';
  content.innerHTML = escapeHtml(text || '');
  msg.appendChild(content);

  const meta = document.createElement('div');
  meta.className = 'meta';
  const whoLabel = who === 'user' ? 'Вы' : 'Помощник';
  meta.innerText = `${whoLabel} • ${new Date().toLocaleTimeString()}`;
  msg.appendChild(meta);

  messagesEl.appendChild(msg);
  messagesEl.scrollTop = messagesEl.scrollHeight;

  if(who === 'ai') {
    lastAiText = text || '';
    lastAiId = msg;
  }
  return { el: msg, contentEl: content, metaEl: meta };
}

// typing indicator
function showTyping(){
  const node = document.createElement('div');
  node.className = 'msg ai typing-indicator';
  node.innerHTML = `<div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>`;
  messagesEl.appendChild(node);
  messagesEl.scrollTop = messagesEl.scrollHeight;
  return node;
}

// Improved reply logic (more useful / practical responses).
function generateReply(raw){
  const t = String(raw || '').trim();
  const low = t.toLowerCase();

  if(!t) return "Вы ничего не написали — напишите вопрос или задачу, с которой нужна помощь.";

  // greetings
  if(/^(прив|здрав|hi|hello|добрый)/i.test(low)) {
    return "Привет! Я тестовый ИИ ассистент , мой разработчик должен обучить меня для полноценной работы) Чем могу помочь?";
  }

  // simple direct Q&A patterns
  if(low.includes('html') && low.includes('шаблон')) {
    return "Готов простой HTML-шаблон: 1) базовая семантика (header/main/footer); 2) адаптивность (meta viewport, flex/grid); 3) подключение шрифтов. Могу сгенерировать полный файл прямо сейчас — напишите: «Сгенерируй HTML лендинг».";
  }

  if(low.match(/(node|npm|установк).*node/i)) {
    return "Коротко: скачайте Node.js с официального сайта, установите и проверьте `node -v` и `npm -v`. Для проекта: `npm init -y`, затем `npm install <пакет>`; если нужно — могу создать step-by-step инструкции для конкретного проекта.";
  }

  if(low.includes('идея') || low.includes('стартап') || low.includes('проект')) {
    return "Вот конкретная идея и быстрый план MVP:\n\n1) Идея: NEON-dashboard — realtime-панель с виджетами.\n2) MVP: базовая аутентификация, 3 виджета (график, лента событий, счетчик). \n3) Технологии: React + Node + WebSocket. \nЕсли хочешь — распишу таски и пример структуры проекта.";
  }

  // if user asked a question (contains '?') — answer concisely
  if(t.includes('?')) {
    // try to provide a helpful short answer plus one-step next action
    return `Короткий ответ:\n— ${generateConciseAnswer(low)}\n\nЕсли нужно, напиши «Подробно: ${t}» и я распишу шаги.`;
  }

  // fallback: detect intent words and respond practically
  const intentKeywords = [
    {k: 'код', resp: 'Если нужен код — скажи язык и задачу (например: "код на python для парсинга страницы"), и я сгенерирую пример.'},
    {k: 'план', resp: 'Чтобы составить план — укажи цель и сроки. Я верну список задач с приоритетами.'},
    {k: 'ошибк', resp: 'Опиши ошибку и приведите стек/текст ошибки — я помогу диагностировать и предложу исправление.'}
  ];
  for(const it of intentKeywords){
    if(low.includes(it.k)) return it.resp;
  }

  // default — constructive multi-part reply
  const generic = [
 "Чем могу помочь?"
  ];
  const pick = generic[Math.floor(Math.random()*generic.length)];
  return pick;
}

// helper to provide very concise answer (simple heuristics)
function generateConciseAnswer(lowerText){
  if(lowerText.includes('как создать')) return 'создать можно через npm init / git / шаблон проекта — опиши целевой стек.';
  if(lowerText.includes('что такое')) return 'это термин/технология; пришли точный термин, дам определение и примеры.';
  return 'зависит от деталей — пришлите больше контекста.';
}

// streaming typing simulation for nicer output
async function handleUser(text){
  appendMessage(text, 'user');
  inputEl.value = '';
  inputEl.disabled = true;
  sendBtn.disabled = true;

  // show typing indicator
  const typingNode = showTyping();

  // generate reply (sync)
  const reply = generateReply(text);

  // small realistic delay
  const delay = Math.min(1400 + Math.max(0, reply.length)*10, 4200);
  await sleep(delay);

  // remove typing and stream reply
  typingNode.remove();

  // create ai message with empty content, then fill char-by-char
  const { el: msgEl, contentEl } = appendMessage('', 'ai');
  await typeOut(contentEl, reply);

  // ensure lastAiText populated
  lastAiText = reply;

  inputEl.disabled = false;
  sendBtn.disabled = false;
  inputEl.focus();
}

function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }

async function typeOut(node, text){
  node.innerHTML = '';
  for(let i=0;i<text.length;i++){
    node.innerHTML += escapeHtml(text[i]);
    messagesEl.scrollTop = messagesEl.scrollHeight;
    // small variable speed for realism
    await sleep(6 + Math.random()*12);
  }
  // update meta timestamp (already added in appendMessage) — refresh to current time
  const parent = node.parentElement;
  const meta = parent.querySelector('.meta');
  if(meta) meta.innerText = `Помощник • ${new Date().toLocaleTimeString()}`;
}

// events
sendBtn.addEventListener('click', ()=> {
  const txt = inputEl.value.trim();
  if(!txt) return;
  handleUser(txt);
});

inputEl.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' && !e.shiftKey){
    e.preventDefault();
    sendBtn.click();
  }
});

// clear
clearBtn.addEventListener('click', ()=> {
  messagesEl.innerHTML = '';
  appendMessage('Чат очищен. Задайте новый вопрос.', 'ai');
});

// TTS (Web Speech) — plays last AI message
ttsBtn.addEventListener('click', ()=> {
  if(!('speechSynthesis' in window)){
    alert('TTS не поддерживается в вашем браузере.');
    return;
  }
  const text = lastAiText || (lastAiId ? (lastAiId.querySelector('.content')?.innerText || '') : '');
  if(!text) { alert('Нет текста для воспроизведения'); return; }
  const ut = new SpeechSynthesisUtterance(text);
  const voices = speechSynthesis.getVoices();
  if(voices.length){
    ut.voice = voices.find(v=>v.lang && v.lang.startsWith('ru')) || voices[0];
  }
  ut.rate = 1;
  ut.pitch = 1;
  speechSynthesis.cancel();
  speechSynthesis.speak(ut);
});

// initial focus
inputEl.focus();

// helpful welcome (only once)
if(!localStorage.getItem('neon_visited')){
  localStorage.setItem('neon_visited','1');
  appendMessage("Я пока что не обучаюсь и не запоминаю, но мои разработчики работают над этим.", 'ai');
}

// auto-scroll observer
const mo = new MutationObserver(()=> messagesEl.scrollTop = messagesEl.scrollHeight);
mo.observe(messagesEl, {childList:true, subtree:false});
</script>
</body>
</html>
