<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ASSISTANT AI ‚Äî  –ò–ò –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç (–ø—Ä–æ—Ç–æ—Ç–∏–ø)</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Roboto+Mono&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#0b1020;
    --bg2:#081021;
    --glass: rgba(255,255,255,0.04);
    --accent: #6be7ff;
    --accent-2: #8a6bff;
    --muted: rgba(255,255,255,0.12);
    --msg-user: linear-gradient(135deg,#0ea5a4,#0ea5c4);
    --msg-ai: linear-gradient(135deg,#2b2f46,#343755);
    --radius: 14px;
    --shadow-lg: 0 20px 50px rgba(2,6,23,0.7);
    --glass-border: rgba(255,255,255,0.04);
    --glass-highlight: rgba(107,231,255,0.06);
  }

  /* Page background with slow gradient animation */
  body{
    margin:0;
    min-height:100vh;
    font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:
      radial-gradient(800px 400px at 10% 10%, rgba(138,107,255,0.07), transparent 8%),
      radial-gradient(600px 300px at 90% 90%, rgba(107,231,255,0.04), transparent 8%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    color: #e8eefc;
    -webkit-font-smoothing:antialiased;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    box-sizing:border-box;
    overflow:hidden;
  }

  /* Patterned animated background elements */
  .pattern {
    position: fixed;
    inset: 0;
    pointer-events: none;
    background-image:
      radial-gradient(circle at 10% 20%, rgba(138,107,255,0.05) 0 120px, transparent 121px),
      radial-gradient(circle at 90% 80%, rgba(107,231,255,0.03) 0 120px, transparent 121px),
      repeating-linear-gradient(45deg, rgba(255,255,255,0.006) 0 1px, transparent 1px 20px);
    mix-blend-mode: overlay;
    opacity: 0.8;
    animation: patternMove 16s linear infinite;
  }
  @keyframes patternMove { from { transform: translateX(-2%); } to { transform: translateX(2%); } }

  /* Main card */
  .card{
    width:980px;
    max-width:98vw;
    height:680px;
    max-height:94vh;
    border-radius:18px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--glass-border);
    display:grid;
    grid-template-columns: 340px 1fr;
    overflow:hidden;
    backdrop-filter: blur(8px) saturate(120%);
    position:relative;
  }

  /* Preloader (over card) */
  #preloader {
    position: fixed;
    inset: 0;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:9999;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    transition: opacity 0.45s ease, visibility 0.45s;
  }
  /* make preloader look like dialog window background with neon logo */
  #preloader-inner{
    width:520px;
    max-width:88vw;
    padding:28px 36px;
    border-radius:14px;
    display:flex;
    gap:16px;
    align-items:center;
    justify-content:center;
    box-shadow: var(--shadow-lg);
    border:1px solid rgba(255,255,255,0.03);
    background: linear-gradient(180deg, rgba(2,6,23,0.6), rgba(8,16,33,0.65));
    position:relative;
    overflow:hidden;
  }
  /* subtle animated neon lines inside preloader */
  #preloader-inner::before,
  #preloader-inner::after{
    content:'';
    position:absolute;
    inset:-30%;
    background: radial-gradient(circle at 20% 30%, rgba(107,231,255,0.04), transparent 10%),
                radial-gradient(circle at 80% 70%, rgba(138,107,255,0.03), transparent 10%);
    filter: blur(30px);
    animation: float 8s linear infinite;
  }
  #preloader-inner::after { animation-duration:12s; transform: rotate(90deg); }
  @keyframes float { from{transform:translateY(-6%)} to{transform:translateY(6%)} }

  .pre-logo {
    width:68px;height:68px;border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    font-weight:800;font-family:"Roboto Mono";
    background: linear-gradient(135deg,var(--accent),var(--accent-2));
    color:#041224;
    font-size:28px;
    box-shadow: 0 10px 30px rgba(107,107,255,0.08);
  }
  .pre-text {
    color:#e8eefc;font-size:18px;font-weight:700;
    letter-spacing:0.6px;
  }

  /* Left panel (info / persona) */
  .left{
    padding:22px;
    border-right:1px solid rgba(255,255,255,0.02);
    display:flex;
    flex-direction:column;
    gap:18px;
    background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent 60%);
  }
  .brand{
    display:flex;
    gap:12px;
    align-items:center;
  }
  .logo{
    width:52px;height:52px;border-radius:12px;
    background:linear-gradient(135deg,var(--accent),var(--accent-2));
    display:flex;align-items:center;justify-content:center;
    font-weight:800;color:#041224;font-family:"Roboto Mono";
    box-shadow: 0 6px 18px rgba(138,107,255,0.12);
  }
  .brand h3{ margin:0;font-size:16px;letter-spacing:0.4px; }
  .brand p{ margin:0;font-size:12px;color:var(--muted) }

  .persona{
    padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015));
    border:1px solid rgba(255,255,255,0.02);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
    font-size:13px;color:var(--muted);
  }

  .left .chips{ display:flex;flex-wrap:wrap;gap:8px; margin-top:6px;}
  .chip{
    background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px 10px;border-radius:999px;font-size:13px;color:var(--muted);
  }

  /* Right: chat area */
  .right{
    display:flex;
    flex-direction:column;
    padding:20px;
    gap:12px;
    position:relative;
  }

  .chat-header{
    display:flex;align-items:center;justify-content:space-between;
    gap:12px;padding:6px 4px;
  }
  .chat-title{
    display:flex;gap:12px;align-items:center;
  }
  .avatar{
    width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#223048,#2b3750);display:flex;align-items:center;justify-content:center;font-weight:700;
    box-shadow: 0 6px 20px rgba(2,6,23,0.6), 0 0 18px rgba(107,231,255,0.04) inset;
  }
  .chat-title h2{ margin:0;font-size:16px }
  .chat-title p{ margin:0;font-size:12px;color:var(--muted) }

  /* Messages viewport */
  .messages{
    flex:1;
    padding:18px;
    overflow:auto;
    display:flex;
    flex-direction:column;
    gap:14px;
    scroll-behavior:smooth;
    -webkit-overflow-scrolling:touch;
  }
  /* nice soft scrollbar */
  .messages::-webkit-scrollbar{ width:8px; }
  .messages::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.03); border-radius:8px; }
  .messages::-webkit-scrollbar-track{ background: transparent; }

  /* message bubble base */
  .msg{
    max-width:78%;
    padding:12px 14px;
    border-radius:12px;
    font-size:14px;line-height:1.45;
    box-shadow: 0 8px 20px rgba(2,6,23,0.45);
    opacity:0;
    transform:translateY(8px) scale(0.995);
    animation: appear .38s ease forwards;
    position: relative;
  }
  @keyframes appear { to{opacity:1; transform:none;} }

  /* user message (right aligned) */
  .msg.user{
    margin-left:auto;
    background:var(--msg-user);
    color:#041224;
    border-bottom-right-radius:6px;
    position:relative;
    box-shadow: 0 12px 30px rgba(14,165,164,0.08);
    border:1px solid rgba(255,255,255,0.04);
  }
  .msg.ai{
    margin-right:auto;
    background:var(--msg-ai);
    color:#e7eefc;
    border-bottom-left-radius:6px;
    border:1px solid rgba(255,255,255,0.02);
  }

  /* thin neon highlight when hovering message */
  .msg:hover{ box-shadow: 0 18px 40px rgba(2,6,23,0.6), 0 0 18px rgba(107,231,255,0.03) inset; transform:translateY(-2px); transition:all .22s ease; }

  /* small meta row */
  .meta{ 
    font-size:11px;
    color:rgba(255,255,255,0.35); 
    margin-top:6px; 
    display:flex;gap:8px; 
    align-items:center; 
    justify-content:flex-end;
    user-select:none;
  }

  /* typing indicator */
  .typing{
    display:inline-flex; gap:6px; align-items:center;
  }
  .dot{
    width:7px;height:7px;border-radius:50%;background:#9fdcff;opacity:0.9;
    transform:scale(0.8);
    animation: blink 1s infinite;
  }
  .dot:nth-child(2){ animation-delay:.15s }
  .dot:nth-child(3){ animation-delay:.33s }
  @keyframes blink{ 0%{transform:translateY(0) scale(.7);opacity:.25}50%{transform:translateY(-6px) scale(1);opacity:1}100%{transform:translateY(0) scale(.85);opacity:.5} }

  /* input area */
  .composer{
    display:flex;
    gap:10px;
    align-items:center;
    padding:12px;
    border-top:1px solid rgba(255,255,255,0.02);
    background: linear-gradient(180deg, rgba(255,255,255,0.005), rgba(255,255,255,0.002));
  }

  .input-wrap{
    flex:1;
    display:flex;
    align-items:center;
    gap:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:8px;
    border:1px solid rgba(255,255,255,0.02);
  }
  .composer input{
    border:0;outline:0;background:transparent;color:inherit;font-size:15px;padding:10px 6px;width:100%;
  }
  .btn{
    border:0;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#041224;font-weight:700;cursor:pointer;
    box-shadow: 0 10px 30px rgba(107,107,255,0.06);
    transition:transform .12s ease;
  }
  .btn:active{ transform:translateY(2px) scale(.995) }

  /* small utility buttons - square small icons */
  .icon-square{
    width:38px;height:38px;display:inline-grid;place-items:center;border-radius:8px;border:0;cursor:pointer;font-size:14px;
    box-shadow: 0 8px 20px rgba(2,6,23,0.45);
  }
  /* play same gradient as send */
  .icon-play{
    background: linear-gradient(90deg,var(--accent),var(--accent-2));
    color:#041224;
  }
  /* clear mirrored gradient */
  .icon-clear{
    background: linear-gradient(90deg,var(--accent-2),var(--accent));
    color:#041224;
  }

  /* responsive */
  @media (max-width:880px){
    .card{ grid-template-columns: 1fr; height:92vh; max-height:92vh; }
    .left{ display:none; }
    .messages{ padding:12px; }
  }
</style>
</head>
<body>
  <div class="pattern" aria-hidden="true"></div>

  <!-- Preloader shown for 5s -->
  <div id="preloader" aria-hidden="false">
    <div id="preloader-inner" role="presentation">
      <div class="pre-logo" aria-hidden="true">AI</div>
      <div class="pre-text">AI ASSISTANT (Test)</div>
    </div>
  </div>

  <main class="card" role="main" aria-label="AI Assistant">
    <!-- LEFT -->
    <aside class="left" aria-hidden="false">
      <div class="brand" role="banner">
        <div class="logo">AI</div>
        <div>
          <h3>ASSISTANT AI</h3>
          <p>–ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç ‚Ä¢ –ü—Ä–æ—Ç–æ—Ç–∏–ø</p>
        </div>
      </div>

      <div class="persona">
        <strong>–í—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å –ò–ò:</strong>
        <div style="margin-top:8px;color:var(--muted);font-size:13px">
           –¢–µ—Å—Ç –≤–µ—Ä—Å–∏—è.
        </div>

        <div class="chips" style="margin-top:12px">
          <div class="chip">ASSISTANT AI 1.0</div>
          <div class="chip">ASSISTANT AI 2.0</div>
          <div class="chip">ASSISTANT AI 3.0</div>
          <div class="chip">ASSISTANT AI 4.0</div>
        </div>
      </div>

      <div style="margin-top:auto;font-size:12px;color:var(--muted)">
        <div style="margin-bottom:8px">–ü–æ–¥—Å–∫–∞–∑–∫–∏:</div>
        <ul style="padding-left:16px;margin:0;color:var(--muted);line-height:1.6">
          <li>–ù–∞–ø–∏—à–∏: <code>–ø—Ä–∏–≤–µ—Ç</code></li>
          <li>–°–ø—Ä–æ—Å–∏ —á—Ç–æ —É–≥–æ–¥–Ω–æ: –∏–¥–µ–∏, –∫–æ–¥, –ø–ª–∞–Ω</li>
          <li>–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏</li>
        </ul>
      </div>
    </aside>

    <!-- RIGHT -->
    <section class="right">
      <div class="chat-header" role="toolbar" aria-label="Chat header">
        <div class="chat-title">
          <div class="avatar">AI</div>
          <div>
            <h2>AI Assistant 1.0</h2>
            <p>–±–µ—Ç–∞-–≤–µ—Ä—Å–∏—è</p>
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <button class="icon-square icon-clear" id="clearBtn" title="–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç" aria-label="–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç">üóë</button>
          <button class="icon-square icon-play" id="ttsBtn" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç" aria-label="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç">‚ñ∂</button>
        </div>
      </div>

      <div class="messages" id="messages" aria-live="polite" aria-atomic="false">
        <!-- initial welcome message -->
        <div class="msg ai" data-id="m0">
          –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–π AI Assistant. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å , –∏–¥–µ—è–º–∏, –ø–ª–∞–Ω–∞–º–∏ –∏ –±—ã—Å—Ç—Ä—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏. –ü–æ–ø—Ä–æ–±—É–π –Ω–∞–ø–∏—Å–∞—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å.
          <div class="meta">–ü–æ–º–æ—â–Ω–∏–∫ ‚Ä¢ —Å–µ–π—á–∞—Å</div>
        </div>
      </div>

      <form class="composer" id="composer" onsubmit="return false;" aria-label="Message composer">
        <div class="input-wrap" role="search">
          <input id="input" autocomplete="off" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..." aria-label="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è" />
        </div>
        <button class="btn" id="sendBtn" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>
    </section>
  </main>

<script>
/* Behaviour:
 - show preloader for 5s then hide
 - single timestamp per message
 - TTS plays last AI reply
 - improved canned reply logic (more practical)
*/

// Preloader hide after 5 seconds (keeps visible while page loads)
const preloader = document.getElementById('preloader');
window.addEventListener('load', ()=> {
  // keep for exactly 5s from script run (gives consistent behavior)
  setTimeout(()=> {
    preloader.style.opacity = '0';
    preloader.style.visibility = 'hidden';
    preloader.setAttribute('aria-hidden','true');
  }, 5000);
});

// Elements
const messagesEl = document.getElementById('messages');
const inputEl = document.getElementById('input');
const sendBtn = document.getElementById('sendBtn');
const clearBtn = document.getElementById('clearBtn');
const ttsBtn = document.getElementById('ttsBtn');

let lastAiText = '';
let lastAiId = null;

// escape
function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

// append message ‚Äî ensures only one meta line
function appendMessage(text, who='ai', options = {}) {
  // options: stream (bool) ‚Äî if true, create content area for streaming
  const msg = document.createElement('div');
  msg.className = 'msg ' + (who === 'user' ? 'user' : 'ai');

  const content = document.createElement('div');
  content.className = 'content';
  content.innerHTML = escapeHtml(text || '');
  msg.appendChild(content);

  const meta = document.createElement('div');
  meta.className = 'meta';
  const whoLabel = who === 'user' ? '–í—ã' : '–ü–æ–º–æ—â–Ω–∏–∫';
  meta.innerText = `${whoLabel} ‚Ä¢ ${new Date().toLocaleTimeString()}`;
  msg.appendChild(meta);

  messagesEl.appendChild(msg);
  messagesEl.scrollTop = messagesEl.scrollHeight;

  if(who === 'ai') {
    lastAiText = text || '';
    lastAiId = msg;
  }
  return { el: msg, contentEl: content, metaEl: meta };
}

// typing indicator
function showTyping(){
  const node = document.createElement('div');
  node.className = 'msg ai typing-indicator';
  node.innerHTML = `<div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>`;
  messagesEl.appendChild(node);
  messagesEl.scrollTop = messagesEl.scrollHeight;
  return node;
}

// Improved reply logic (more useful / practical responses).
function generateReply(raw){
  const t = String(raw || '').trim();
  const low = t.toLowerCase();

  if(!t) return "–í—ã –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–ø–∏—Å–∞–ª–∏ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –∑–∞–¥–∞—á—É, —Å –∫–æ—Ç–æ—Ä–æ–π –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å.";

  // greetings
  if(/^(–ø—Ä–∏–≤|–∑–¥—Ä–∞–≤|hi|hello|–¥–æ–±—Ä—ã–π)/i.test(low)) {
    return "–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–µ—Å—Ç–æ–≤—ã–π –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç , –º–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω –æ–±—É—á–∏—Ç—å –º–µ–Ω—è –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã) –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?";
  }

  // simple direct Q&A patterns
  if(low.includes('html') && low.includes('—à–∞–±–ª–æ–Ω')) {
    return "–ì–æ—Ç–æ–≤ –ø—Ä–æ—Å—Ç–æ–π HTML-—à–∞–±–ª–æ–Ω: 1) –±–∞–∑–æ–≤–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞ (header/main/footer); 2) –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å (meta viewport, flex/grid); 3) –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–æ–≤. –ú–æ–≥—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ñ–∞–π–ª –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ: ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π HTML –ª–µ–Ω–¥–∏–Ω–≥¬ª.";
  }

  if(low.match(/(node|npm|—É—Å—Ç–∞–Ω–æ–≤–∫).*node/i)) {
    return "–ö–æ—Ä–æ—Ç–∫–æ: —Å–∫–∞—á–∞–π—Ç–µ Node.js —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `node -v` –∏ `npm -v`. –î–ª—è –ø—Ä–æ–µ–∫—Ç–∞: `npm init -y`, –∑–∞—Ç–µ–º `npm install <–ø–∞–∫–µ—Ç>`; –µ—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å step-by-step –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.";
  }

  if(low.includes('–∏–¥–µ—è') || low.includes('—Å—Ç–∞—Ä—Ç–∞–ø') || low.includes('–ø—Ä–æ–µ–∫—Ç')) {
    return "–í–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∏–¥–µ—è –∏ –±—ã—Å—Ç—Ä—ã–π –ø–ª–∞–Ω MVP:\n\n1) –ò–¥–µ—è: NEON-dashboard ‚Äî realtime-–ø–∞–Ω–µ–ª—å —Å –≤–∏–¥–∂–µ—Ç–∞–º–∏.\n2) MVP: –±–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, 3 –≤–∏–¥–∂–µ—Ç–∞ (–≥—Ä–∞—Ñ–∏–∫, –ª–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π, —Å—á–µ—Ç—á–∏–∫). \n3) –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏: React + Node + WebSocket. \n–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî —Ä–∞—Å–ø–∏—à—É —Ç–∞—Å–∫–∏ –∏ –ø—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞.";
  }

  // if user asked a question (contains '?') ‚Äî answer concisely
  if(t.includes('?')) {
    // try to provide a helpful short answer plus one-step next action
    return `–ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç:\n‚Äî ${generateConciseAnswer(low)}\n\n–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –Ω–∞–ø–∏—à–∏ ¬´–ü–æ–¥—Ä–æ–±–Ω–æ: ${t}¬ª –∏ —è —Ä–∞—Å–ø–∏—à—É —à–∞–≥–∏.`;
  }

  // fallback: detect intent words and respond practically
  const intentKeywords = [
    {k: '–∫–æ–¥', resp: '–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –∫–æ–¥ ‚Äî —Å–∫–∞–∂–∏ —è–∑—ã–∫ –∏ –∑–∞–¥–∞—á—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–∫–æ–¥ –Ω–∞ python –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã"), –∏ —è —Å–≥–µ–Ω–µ—Ä–∏—Ä—É—é –ø—Ä–∏–º–µ—Ä.'},
    {k: '–ø–ª–∞–Ω', resp: '–ß—Ç–æ–±—ã —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω ‚Äî —É–∫–∞–∂–∏ —Ü–µ–ª—å –∏ —Å—Ä–æ–∫–∏. –Ø –≤–µ—Ä–Ω—É —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏.'},
    {k: '–æ—à–∏–±–∫', resp: '–û–ø–∏—à–∏ –æ—à–∏–±–∫—É –∏ –ø—Ä–∏–≤–µ–¥–∏—Ç–µ —Å—Ç–µ–∫/—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ ‚Äî —è –ø–æ–º–æ–≥—É –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–µ–¥–ª–æ–∂—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.'}
  ];
  for(const it of intentKeywords){
    if(low.includes(it.k)) return it.resp;
  }

  // default ‚Äî constructive multi-part reply
  const generic = [
 "–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"
  ];
  const pick = generic[Math.floor(Math.random()*generic.length)];
  return pick;
}

// helper to provide very concise answer (simple heuristics)
function generateConciseAnswer(lowerText){
  if(lowerText.includes('–∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å')) return '—Å–æ–∑–¥–∞—Ç—å –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ npm init / git / —à–∞–±–ª–æ–Ω –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –æ–ø–∏—à–∏ —Ü–µ–ª–µ–≤–æ–π —Å—Ç–µ–∫.';
  if(lowerText.includes('—á—Ç–æ —Ç–∞–∫–æ–µ')) return '—ç—Ç–æ —Ç–µ—Ä–º–∏–Ω/—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è; –ø—Ä–∏—à–ª–∏ —Ç–æ—á–Ω—ã–π —Ç–µ—Ä–º–∏–Ω, –¥–∞–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ—Ä—ã.';
  return '–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–µ—Ç–∞–ª–µ–π ‚Äî –ø—Ä–∏—à–ª–∏—Ç–µ –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.';
}

// streaming typing simulation for nicer output
async function handleUser(text){
  appendMessage(text, 'user');
  inputEl.value = '';
  inputEl.disabled = true;
  sendBtn.disabled = true;

  // show typing indicator
  const typingNode = showTyping();

  // generate reply (sync)
  const reply = generateReply(text);

  // small realistic delay
  const delay = Math.min(1400 + Math.max(0, reply.length)*10, 4200);
  await sleep(delay);

  // remove typing and stream reply
  typingNode.remove();

  // create ai message with empty content, then fill char-by-char
  const { el: msgEl, contentEl } = appendMessage('', 'ai');
  await typeOut(contentEl, reply);

  // ensure lastAiText populated
  lastAiText = reply;

  inputEl.disabled = false;
  sendBtn.disabled = false;
  inputEl.focus();
}

function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }

async function typeOut(node, text){
  node.innerHTML = '';
  for(let i=0;i<text.length;i++){
    node.innerHTML += escapeHtml(text[i]);
    messagesEl.scrollTop = messagesEl.scrollHeight;
    // small variable speed for realism
    await sleep(6 + Math.random()*12);
  }
  // update meta timestamp (already added in appendMessage) ‚Äî refresh to current time
  const parent = node.parentElement;
  const meta = parent.querySelector('.meta');
  if(meta) meta.innerText = `–ü–æ–º–æ—â–Ω–∏–∫ ‚Ä¢ ${new Date().toLocaleTimeString()}`;
}

// events
sendBtn.addEventListener('click', ()=> {
  const txt = inputEl.value.trim();
  if(!txt) return;
  handleUser(txt);
});

inputEl.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' && !e.shiftKey){
    e.preventDefault();
    sendBtn.click();
  }
});

// clear
clearBtn.addEventListener('click', ()=> {
  messagesEl.innerHTML = '';
  appendMessage('–ß–∞—Ç –æ—á–∏—â–µ–Ω. –ó–∞–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å.', 'ai');
});

// TTS (Web Speech) ‚Äî plays last AI message
ttsBtn.addEventListener('click', ()=> {
  if(!('speechSynthesis' in window)){
    alert('TTS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.');
    return;
  }
  const text = lastAiText || (lastAiId ? (lastAiId.querySelector('.content')?.innerText || '') : '');
  if(!text) { alert('–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è'); return; }
  const ut = new SpeechSynthesisUtterance(text);
  const voices = speechSynthesis.getVoices();
  if(voices.length){
    ut.voice = voices.find(v=>v.lang && v.lang.startsWith('ru')) || voices[0];
  }
  ut.rate = 1;
  ut.pitch = 1;
  speechSynthesis.cancel();
  speechSynthesis.speak(ut);
});

// initial focus
inputEl.focus();

// helpful welcome (only once)
if(!localStorage.getItem('neon_visited')){
  localStorage.setItem('neon_visited','1');
  appendMessage("–Ø –ø–æ–∫–∞ —á—Ç–æ –Ω–µ –æ–±—É—á–∞—é—Å—å –∏ –Ω–µ –∑–∞–ø–æ–º–∏–Ω–∞—é, –Ω–æ –º–æ–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–¥ —ç—Ç–∏–º.", 'ai');
}

// auto-scroll observer
const mo = new MutationObserver(()=> messagesEl.scrollTop = messagesEl.scrollHeight);
mo.observe(messagesEl, {childList:true, subtree:false});
</script>
</body>
</html>
